package com.skrrrrr.harudam.verification;

import org.springframework.http.ResponseEntity;
import org.springframework.security.core.Authentication;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import lombok.Getter;
import lombok.NoArgsConstructor;
import lombok.RequiredArgsConstructor;

@RestController
@RequestMapping("/api")
@RequiredArgsConstructor
@CrossOrigin(origins = "http://localhost:5173")
public class VerificationController {
	
	private final VerificationService verificationService;
	
	@Getter @NoArgsConstructor
	static class SendCodeReq { private String phone; }
	
	@Getter @NoArgsConstructor
	static class VerifiCodeReq { private String phone; private String code; }
	
	@Getter
	static class simpleRes {
		private final boolean success;
		private final String message;
		public SimpleRes(boolean success, String message) {
			this.success = success; this.message = message;
		}
	}
	
	// 인증번호 발급
	@PostMapping("/send-verification-code")
	public ResponseEntity<simpleRes> sendVerificationCode(
			@RequestBody SendCodeReq req,
			Authentication authentication) {
		if (req == null || req.getPhone() == null || req.getPhone().isBlank()) {
			return ResponseEntity.badRequest().body(new SimpleRes(false, "phone 값을 입력하세요."));
		}
		
		verificationService.sendCode(new SimpleRes(true, "인증번호를 전송했습니다."));
	}
	
	

}
